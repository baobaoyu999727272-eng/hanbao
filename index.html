<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>HANBAO â€” å¾®ä¿¡æ¨¡æ‹Ÿä¸ API è®¾ç½® æ¼”ç¤º</title>
    <style>
      :root{ --accent:#34c759; --bg:#f4f7fb }
      html,body{height:100%;margin:0}
      body{font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue","PingFang SC","Noto Sans SC",Arial,sans-serif;background:linear-gradient(180deg,var(--bg),#eef4fb);display:flex;align-items:center;justify-content:center}
      .phone{width:390px;max-width:92vw;border-radius:36px;background:#07101a;color:#e6eef8;box-shadow:0 20px 60px rgba(2,6,23,0.45);overflow:hidden}
      .notch{height:32px;background:#080809;border-top-left-radius:14px;border-top-right-radius:14px}
      .screen{padding:12px}
      .header{display:flex;align-items:center;justify-content:space-between;padding:8px 12px}
      .title{font-weight:700}
      .app-grid{display:flex;gap:10px;justify-content:center;padding:10px}
      .app-icon{width:64px;height:78px;text-align:center;color:#dfe7f3}
      .icon-bg{width:56px;height:56px;border-radius:12px;overflow:hidden;background:#08131a;margin:0 auto 6px;display:flex;align-items:center;justify-content:center}
      .messages{max-height:380px;overflow:auto;padding:8px;display:flex;flex-direction:column;gap:8px}
      .msg-row{display:flex}
      .msg-row.me{justify-content:flex-end}
      .bubble{padding:8px 12px;border-radius:16px;max-width:72%;box-shadow:0 6px 18px rgba(0,0,0,0.35)}
      .bubble.you{background:#fff;color:#0b1220;border-bottom-left-radius:6px}
      .bubble.me{background:linear-gradient(180deg,var(--accent),#2ea84b);color:#fff;border-bottom-right-radius:6px}
      .input-row{display:flex;gap:8px;padding:10px}
      input[type="text"]{flex:1;padding:10px;border-radius:20px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:inherit}
      button.form-button{background:#0b84ff;color:white;padding:8px 12px;border-radius:10px;border:none;cursor:pointer}
      .note{font-size:12px;color:#9fb6d6;text-align:center;padding:8px}
      .settings{display:none;padding:8px}
      .settings.active,.screen.active{display:block}
      .form-group{margin-bottom:8px}
      .form-group label{display:block;font-size:13px;color:#c7d3e6;margin-bottom:6px}
      .form-group input,.form-group select{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:inherit}
      footer{font-size:12px;color:#9fb6d6;padding:8px;text-align:center}
    </style>
  </head>
  <body>
    <div class="phone" role="application" aria-label="HANBAO Demo Phone">
      <div class="notch"></div>
      <div class="screen">
        <div class="header">
          <div class="title">HANBAO</div>
          <div style="display:flex;gap:8px">
            <button id="btnHome" title="ä¸»é¡µ" class="form-button">ä¸»é¡µ</button>
            <button id="btnChat" title="èŠå¤©" class="form-button">èŠå¤©</button>
            <button id="btnSettings" title="è®¾ç½®" class="form-button">è®¾ç½®</button>
          </div>
        </div>

        <div id="home-screen" class="screen active">
          <div style="text-align:center;padding:18px 6px">
            <div style="font-size:28px">12:00</div>
            <div style="font-size:12px;color:#9fb6d6">æ˜ŸæœŸä¸€, 1æœˆ1æ—¥</div>
            <div style="margin-top:8px;font-weight:700;color:#dfe7f3">HANBAO</div>
          </div>
          <div class="app-grid">
            <div class="app-icon" data-app="wechat">
              <div class="icon-bg"><img src="https://i.postimg.cc/9Q2g1Y2H/wechat.png" alt="å¾®ä¿¡" style="width:100%"></div>
              <div>å¾®ä¿¡</div>
            </div>
            <div class="app-icon" data-app="notes">
              <div class="icon-bg">ğŸ“·</div>
              <div>ç›¸å†Œ</div>
            </div>
            <div class="app-icon" data-app="settings">
              <div class="icon-bg">âš™ï¸</div>
              <div>è®¾ç½®</div>
            </div>
          </div>
          <div class="note">é¡¹ç›®ä»“åº“ï¼š<a href="https://github.com/baobaoyu999727272-eng/baobaoyu-xiaoshouji" target="_blank" rel="noreferrer">baobaoyu-xiaoshouji</a></div>
        </div>

        <div id="chat-screen" class="screen">
          <div style="display:flex;align-items:center;justify-content:space-between;padding:6px 0"><strong>AI èŠå¤©</strong></div>
          <div id="messages" class="messages">
            <div class="msg-row you"><div class="bubble you">ä½ å¥½ï¼Œæˆ‘æ˜¯ AI åŠ©æ‰‹ã€‚</div></div>
          </div>
          <div class="input-row">
            <input id="inputBox" type="text" placeholder="è¾“å…¥æ¶ˆæ¯..." aria-label="æ¶ˆæ¯è¾“å…¥">
            <button id="sendBtn" class="form-button">å‘é€</button>
          </div>
        </div>

        <div id="settings-screen" class="settings">
          <div style="font-weight:600;margin-bottom:8px">API è®¾ç½®</div>
          <div class="form-group">
            <label>ä¸­è½¬ç«™åœ°å€</label>
            <input id="proxyUrl" placeholder="https://your-proxy.example.com">
          </div>
          <div class="form-group">
            <label>API Keyï¼ˆä»…æµ‹è¯•ï¼‰</label>
            <input id="apiKey" placeholder="sk-... æˆ– Gemini token">
          </div>
          <div class="form-group">
            <label>æ¨¡å‹</label>
            <input id="model" placeholder="gpt-4o æˆ– text-bison">
          </div>
          <div style="display:flex;gap:8px">
            <button id="saveApiBtn" class="form-button">ä¿å­˜</button>
            <button id="testApiBtn" class="form-button" style="background:#06b6d4">æµ‹è¯•</button>
          </div>
          <div id="apiStatus" class="note" style="padding-top:6px"></div>
        </div>

        <footer>å‰ç«¯ç¤ºä¾‹ï¼šä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å°†å¯†é’¥æ”¾åœ¨å‰ç«¯ã€‚æ¨èä½¿ç”¨æœåŠ¡å™¨ä¸­è½¬å­˜å‚¨å¯†é’¥ã€‚</footer>
      </div>
    </div>

    <script>
      // å±å¹•åˆ‡æ¢
      function showScreen(id){ document.querySelectorAll('#home-screen,#chat-screen,#settings-screen').forEach(s=>s.classList.remove('active')); document.getElementById(id).classList.add('active'); }
      document.getElementById('btnHome').addEventListener('click',()=>showScreen('home-screen'));
      document.getElementById('btnChat').addEventListener('click',()=>showScreen('chat-screen'));
      document.getElementById('btnSettings').addEventListener('click',()=>showScreen('settings-screen'));
      document.querySelectorAll('[data-app="wechat"]').forEach(el=>el.addEventListener('click',()=>showScreen('chat-screen')));
      document.querySelectorAll('[data-app="settings"]').forEach(el=>el.addEventListener('click',()=>showScreen('settings-screen')));

      // è®¾ç½®ä¿å­˜/åŠ è½½ï¼ˆä½¿ç”¨ hanbao-settingsï¼‰
      function loadSettings(){ const s = JSON.parse(localStorage.getItem('hanbao-settings')||'{}'); document.getElementById('proxyUrl').value = s.proxyUrl||''; document.getElementById('apiKey').value = s.apiKey||''; document.getElementById('model').value = s.model||''; }
      function saveSettings(){ const s = { proxyUrl: document.getElementById('proxyUrl').value.trim(), apiKey: document.getElementById('apiKey').value.trim(), model: document.getElementById('model').value.trim() }; localStorage.setItem('hanbao-settings', JSON.stringify(s)); const status=document.getElementById('apiStatus'); status.textContent='è®¾ç½®å·²ä¿å­˜'; setTimeout(()=>status.textContent='',2200); }
      document.getElementById('saveApiBtn').addEventListener('click',saveSettings); loadSettings();

      // èŠå¤©
      const messagesEl = document.getElementById('messages');
      const inputBox = document.getElementById('inputBox');
      const sendBtn = document.getElementById('sendBtn');

      function appendMessage(text, who='you'){ const row=document.createElement('div'); row.className='msg-row '+(who==='me'?'me':'you'); const b=document.createElement('div'); b.className='bubble '+(who==='me'?'me':'you'); b.innerText=text; row.appendChild(b); messagesEl.appendChild(row); messagesEl.scrollTop = messagesEl.scrollHeight; }

      sendBtn.addEventListener('click', handleSend);
      inputBox.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); handleSend(); } });

      async function handleSend(){ const text = inputBox.value.trim(); if(!text) return; appendMessage(text,'me'); inputBox.value=''; appendMessage('æ­£åœ¨ç”Ÿæˆå›å¤...','you'); try{ const reply = await callConfiguredAPI(text); const last = messagesEl.querySelectorAll('.msg-row.you'); if(last.length) last[last.length-1].remove(); appendMessage(reply,'you'); }catch(err){ console.error(err); const last = messagesEl.querySelectorAll('.msg-row.you'); if(last.length) last[last.length-1].remove(); appendMessage('è¯·æ±‚å¤±è´¥ï¼š'+(err.message||err),'you'); } }

      async function callConfiguredAPI(userMessage){ const cfg = JSON.parse(localStorage.getItem('hanbao-settings')||'{}'); if(cfg.proxyUrl){ const url = cfg.proxyUrl.replace(/\/$/,'') + '/v1/chat'; const res = await fetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body: JSON.stringify({model: cfg.model||'gpt-4o', message: userMessage})}); if(!res.ok) throw new Error('ä»£ç†è¿”å› '+res.status); const d = await res.json(); return d.reply || d.message || d.result || JSON.stringify(d); } if(cfg.apiKey){ try{ const res = await fetch('https://api.openai.com/v1/chat/completions',{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+cfg.apiKey},body: JSON.stringify({model: cfg.model||'gpt-4o', messages:[{role:'user', content:userMessage}]})}); const j = await res.json(); return j.choices?.[0]?.message?.content || JSON.stringify(j); }catch(e){ throw e; } } return new Promise(r=>setTimeout(()=>r('æœ¬åœ°æ¨¡æ‹Ÿå›å¤ï¼š'+userMessage.split('').reverse().join('')),700)); }

      document.getElementById('testApiBtn').addEventListener('click', async ()=>{ const s = JSON.parse(localStorage.getItem('hanbao-settings')||'{}'); const status=document.getElementById('apiStatus'); status.textContent='æ­£åœ¨æµ‹è¯•...'; try{ if(s.proxyUrl){ const url = s.proxyUrl.replace(/\/$/,'') + '/v1/ping'; const r = await fetch(url); if(!r.ok) throw new Error('ä»£ç†è¿”å› '+r.status); status.textContent='ä»£ç†å¯è¾¾'; }else{ status.textContent='è¯·å¡«å†™ä¸­è½¬ç«™åœ°å€ä»¥æµ‹è¯•'; } }catch(e){ status.textContent='æµ‹è¯•å¤±è´¥: '+(e.message||e); } setTimeout(()=>status.textContent='',3000); });
    </script>
  </body>
</html>

                  // è®¾ç½®ä¿å­˜/åŠ è½½ï¼ˆä½¿ç”¨ hanbao-settingsï¼‰
                  function loadSettings(){ const s = JSON.parse(localStorage.getItem('hanbao-settings')||'{}'); document.getElementById('proxyUrl').value = s.proxyUrl||''; document.getElementById('apiKey').value = s.apiKey||''; document.getElementById('model').value = s.model||''; }
                  function saveSettings(){ const s = { proxyUrl: document.getElementById('proxyUrl').value.trim(), apiKey: document.getElementById('apiKey').value.trim(), model: document.getElementById('model').value.trim() }; localStorage.setItem('hanbao-settings', JSON.stringify(s)); const status=document.getElementById('apiStatus'); status.textContent='è®¾ç½®å·²ä¿å­˜'; setTimeout(()=>status.textContent='',2200); }
                  document.getElementById('saveApiBtn').addEventListener('click',saveSettings); loadSettings();

                  // èŠå¤©
                  const messagesEl = document.getElementById('messages');
                  const inputBox = document.getElementById('inputBox');
                  const sendBtn = document.getElementById('sendBtn');

                  function appendMessage(text, who='you'){ const row=document.createElement('div'); row.className='msg-row '+(who==='me'?'me':'you'); const b=document.createElement('div'); b.className='bubble '+(who==='me'?'me':'you'); b.innerText=text; row.appendChild(b); messagesEl.appendChild(row); messagesEl.scrollTop = messagesEl.scrollHeight; }

                  sendBtn.addEventListener('click', handleSend);
                  inputBox.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); handleSend(); } });

                  async function handleSend(){ const text = inputBox.value.trim(); if(!text) return; appendMessage(text,'me'); inputBox.value=''; appendMessage('æ­£åœ¨ç”Ÿæˆå›å¤...','you'); try{ const reply = await callConfiguredAPI(text); // remove placeholder
                    const last = messagesEl.querySelectorAll('.msg-row.you'); if(last.length) last[last.length-1].remove(); appendMessage(reply,'you'); }catch(err){ console.error(err); const last = messagesEl.querySelectorAll('.msg-row.you'); if(last.length) last[last.length-1].remove(); appendMessage('è¯·æ±‚å¤±è´¥ï¼š'+(err.message||err),'you'); } }

                  async function callConfiguredAPI(userMessage){ const cfg = JSON.parse(localStorage.getItem('hanbao-settings')||'{}'); if(cfg.proxyUrl){ const url = cfg.proxyUrl.replace(/\/$/,'') + '/v1/chat'; const res = await fetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body: JSON.stringify({model: cfg.model||'gpt-4o', message: userMessage})}); if(!res.ok) throw new Error('ä»£ç†è¿”å› '+res.status); const d = await res.json(); return d.reply || d.message || d.result || JSON.stringify(d); } // openai direct (only test)
                    if(cfg.apiKey){ try{ const res = await fetch('https://api.openai.com/v1/chat/completions',{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+cfg.apiKey},body: JSON.stringify({model: cfg.model||'gpt-4o', messages:[{role:'user', content:userMessage}]})}); const j = await res.json(); return j.choices?.[0]?.message?.content || JSON.stringify(j); }catch(e){ throw e; } }
                  // fallback local simulated reply
                  return new Promise(r=>setTimeout(()=>r('æœ¬åœ°æ¨¡æ‹Ÿå›å¤ï¼š'+userMessage.split('').reverse().join('')),700)); }

                  document.getElementById('testApiBtn').addEventListener('click', async ()=>{ const s = JSON.parse(localStorage.getItem('hanbao-settings')||'{}'); const status=document.getElementById('apiStatus'); status.textContent='æ­£åœ¨æµ‹è¯•...'; try{ if(s.proxyUrl){ const url = s.proxyUrl.replace(/\/$/,'') + '/v1/ping'; const r = await fetch(url); if(!r.ok) throw new Error('ä»£ç†è¿”å› '+r.status); status.textContent='ä»£ç†å¯è¾¾'; }else{ status.textContent='è¯·å¡«å†™ä¸­è½¬ç«™åœ°å€ä»¥æµ‹è¯•'; } }catch(e){ status.textContent='æµ‹è¯•å¤±è´¥: '+(e.message||e); } setTimeout(()=>status.textContent='',3000); });
                </script>
              </body>
            </html>
                  </div>
                  <div id="apiStatus" style="margin-top:8px;color:#9fb6d6"></div>
                </div>
              </div>
            </div>
          </div>
          <footer>å·²åšå¥½å‰ç«¯ï¼šå¯å¡«å†™ä¸­è½¬ç«™åœ°å€ä»¥è¿æ¥ Gemini/OpenAI å…¼å®¹ä¸­è½¬ç«™ã€‚</footer>

          <script>
            // å±å¹•åˆ‡æ¢
            function showScreen(id){ document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); document.getElementById(id).classList.add('active'); }
            document.getElementById('wechat-app').addEventListener('click', ()=> showScreen('chat-list-screen'));
            document.getElementById('settings-app').addEventListener('click', ()=> showScreen('api-settings-screen'));
            document.querySelector('[data-chat="ai-chat"]').addEventListener('click', ()=> showScreen('chat-interface-screen'));

            // è®¾ç½®ä¿å­˜/åŠ è½½
            const saveApiBtn = document.getElementById('saveApiBtn');
            const testApiBtn = document.getElementById('testApiBtn');
            const apiStatus = document.getElementById('apiStatus');
            function loadSettings(){ const s = JSON.parse(localStorage.getItem('ep_settings')||'{}'); document.getElementById('apiType').value = s.apiType||'proxy'; document.getElementById('proxyUrl').value = s.proxyUrl||''; document.getElementById('apiKey').value = s.apiKey||''; document.getElementById('model').value = s.model||''; }
            function saveSettings(){ const s = { apiType:document.getElementById('apiType').value, proxyUrl:document.getElementById('proxyUrl').value.trim(), apiKey:document.getElementById('apiKey').value.trim(), model:document.getElementById('model').value.trim() }; localStorage.setItem('ep_settings', JSON.stringify(s)); apiStatus.textContent='è®¾ç½®å·²ä¿å­˜'; setTimeout(()=>apiStatus.textContent='',2200); }
            saveApiBtn.addEventListener('click', saveSettings); loadSettings();

            // èŠå¤©æ ¸å¿ƒå…ƒç´ ï¼ˆä»…æ­¤å¤„å£°æ˜ï¼‰
            const messagesEl = document.getElementById('messages');
            const inputBox = document.getElementById('inputBox');
            const sendBtn = document.getElementById('sendBtn');

            function appendMessage(text, who='you'){ const row=document.createElement('div'); row.className='msg-row '+(who==='me'?'me':'you'); const b=document.createElement('div'); b.className='bubble '+(who==='me'?'me':'you'); b.innerText=text; row.appendChild(b); messagesEl.appendChild(row); messagesEl.scrollTop = messagesEl.scrollHeight; }

            sendBtn.addEventListener('click', async ()=>{ const text=inputBox.value.trim(); if(!text) return; appendMessage(text,'me'); inputBox.value=''; appendMessage('æ­£åœ¨ç”Ÿæˆå›å¤...','you'); try{ const reply = await callConfiguredAPI(text); const last = messagesEl.querySelectorAll('.msg-row.you'); if(last.length) last[last.length-1].remove(); appendMessage(reply,'you'); }catch(e){ console.error(e); const last = messagesEl.querySelectorAll('.msg-row.you'); if(last.length) last[last.length-1].remove(); appendMessage('è¯·æ±‚å¤±è´¥ï¼š'+(e.message||e),'you'); } });

            async function callConfiguredAPI(userMessage){ const cfg = JSON.parse(localStorage.getItem('ep_settings')||'{}'); if(cfg.apiType==='proxy' && cfg.proxyUrl){ const url = cfg.proxyUrl.replace(/\/$/,'') + '/v1/chat'; const res = await fetch(url,{ method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ model: cfg.model||'gpt-4o', message: userMessage }) }); if(!res.ok) throw new Error('ä»£ç†è¿”å› '+res.status); const data = await res.json(); return data.reply || data.message || data.result || JSON.stringify(data); } if(cfg.apiType==='openai' && cfg.apiKey){ const res = await fetch('https://api.openai.com/v1/chat/completions',{ method:'POST', headers:{ 'Content-Type':'application/json','Authorization':'Bearer '+cfg.apiKey }, body: JSON.stringify({ model: cfg.model||'gpt-4o', messages:[{role:'user', content:userMessage}] }) }); const d=await res.json(); return d.choices?.[0]?.message?.content || JSON.stringify(d); } if(cfg.apiType==='gemini' && cfg.apiKey){ throw new Error('Gemini å®˜æ–¹ç›´è¿éœ€æœåŠ¡å™¨ç«¯æˆæƒï¼Œè¯·ä½¿ç”¨ä¸­è½¬ä»£ç†'); } return new Promise(r=>setTimeout(()=>r('æœ¬åœ°æ¨¡æ‹Ÿå›å¤ï¼š'+userMessage.split('').reverse().join('')),700)); }

            testApiBtn.addEventListener('click', async ()=>{ const s = JSON.parse(localStorage.getItem('ep_settings')||'{}'); apiStatus.textContent='æ­£åœ¨æµ‹è¯•...'; try{ if(s.apiType==='proxy' && s.proxyUrl){ const url = s.proxyUrl.replace(/\/$/,'') + '/v1/ping'; const r = await fetch(url); if(!r.ok) throw new Error('ä»£ç†è¿”å› '+r.status); apiStatus.textContent='ä»£ç†å¯è¾¾'; }else{ apiStatus.textContent='è¯·é€‰æ‹©æˆ–é…ç½®ä¸­è½¬ä»£ç†ä»¥æµ‹è¯•'; } }catch(e){ apiStatus.textContent='æµ‹è¯•å¤±è´¥: '+(e.message||e); } setTimeout(()=>apiStatus.textContent='',3000); });

            // å°æç¤ºï¼šè‡ªåŠ¨èšç„¦è¾“å…¥
            inputBox.addEventListener('focus', ()=>{});
          </script>
        </body>
      </html>
